{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Mission Object (companion repo demo)",
  "type": "object",
  "required": ["mission_id", "goal", "scope"],
  "properties": {
    "mission_id": {"type": "string"},
    "kind": {
      "type": "string",
      "description": "Template/category, e.g. doc_sync, schema_evolution, bounded_refactor."
    },
    "goal": {"type": "string"},

    "scope": {
      "type": "object",
      "description": "Blast radius + edit surface.",
      "properties": {
        "target_file": {"type": "string"},
        "target_dir": {"type": "string"},
        "allowed_heading": {"type": "string"},
        "allowed_edit_region": {
          "type": "object",
          "properties": {
            "heading": {"type": "string"},
            "start_marker": {"type": "string"},
            "end_marker": {"type": "string"}
          },
          "additionalProperties": true
        },
        "write_allowlist": {"type": "array", "items": {"type": "string"}},
        "read_allowlist": {"type": "array", "items": {"type": "string"}},
        "protected_paths": {"type": "array", "items": {"type": "string"}}
      },
      "additionalProperties": true
    },

    "slice": {
      "type": "object",
      "properties": {
        "anchors": {"type": "array", "items": {"type": "string"}},
        "terrain_roots": {"type": "array", "items": {"type": "string"}},
        "map_files": {"type": "array", "items": {"type": "string"}},
        "max_nodes": {"type": "integer"},
        "max_tokens": {"type": "integer"}
      },
      "additionalProperties": true
    },

    "diff_policy": {
      "type": "object",
      "description": "What diff shapes are admissible.",
      "properties": {
        "must_be_diff_only": {"type": "boolean"},
        "format": {"type": "string", "enum": ["unified_diff", "git_patch"]},
        "allow_new_files": {"type": "boolean"},
        "allow_deletes": {"type": "boolean"}
      },
      "additionalProperties": true
    },

    "budgets": {
      "type": "object",
      "description": "Circuit breakers / resource limits.",
      "properties": {
        "max_iterations": {"type": "integer"},
        "max_files_changed": {"type": "integer"},
        "max_lines_changed": {"type": "integer"},
        "max_tokens": {"type": "integer"},
        "max_cost_usd": {"type": "number"},
        "max_wall_seconds": {"type": "integer"}
      },
      "additionalProperties": true
    },

    "prep": {
      "type": "object",
      "description": "Deterministic request construction (template-driven).",
      "properties": {
        "template_path": {"type": "string"},
        "output_contract": {"type": "string"},
        "context_builder": {
          "type": "object",
          "properties": {
            "cmd": {"type": "string"},
            "out": {"type": "string"}
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },

    "validators": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {"type": "string"},
          "cmd": {"type": "string"}
        },
        "additionalProperties": true
      }
    },

    "telemetry": {
      "type": "object",
      "description": "Where traces/metrics are written.",
      "properties": {
        "trace_dir": {"type": "string"},
        "tags": {"type": "object"},
        "emit": {"type": "array", "items": {"type": "string"}}
      },
      "additionalProperties": true
    },

    "lifecycle": {
      "type": "object",
      "properties": {
        "status": {"type": "string"},
        "attempt_count": {"type": "integer"},
        "last_run_id": {"type": "string"}
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
